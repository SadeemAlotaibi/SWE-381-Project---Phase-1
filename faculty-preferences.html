<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Faculty Preferences - FTSMS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .required::after{content:" *"; color:#dc3545}
    .badge-course{font-size:.9rem}
  </style>
</head>
<body>
  <!-- Header (نفس ستايل الفريم وورك) -->
  <header class="site-header">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between py-3">
        <div class="d-flex align-items-center gap-3">
          <img src="images/swe-logo.JPG" alt="SWE Logo" class="logo">
          <div>
            <h1 class="mb-0">Faculty Preferences</h1>
            <p class="mb-0 text-muted">King Saud University - Department of Software Engineering</p>
          </div>
        </div>
        <div class="d-flex align-items-center gap-3">
          <span class="user-name">Faculty</span>
          <button onclick="logout()" class="btn btn-outline-secondary">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container my-4">
    <div class="row">
      <div class="col-lg-10 col-xl-9">
        <form id="prefForm" class="content-card p-4">
          <h2 class="h4 mb-3">Submit Preferences for Upcoming Semester</h2>

          <!-- Basic info -->
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label required">Full Name</label>
              <input class="form-control" name="name" placeholder="e.g., Dr. Sara Al-..." required>
            </div>
            <div class="col-md-6">
              <label class="form-label required">Academic Rank</label>
              <select class="form-select" name="rank" required>
                <option value="" selected disabled>Choose…</option>
                <option>Professor</option>
                <option>Associate Professor</option>
                <option>Assistant Professor</option>
                <option>Lecturer</option>
                <option>Teaching Assistant</option>
              </select>
              <div class="form-text">Maximum teaching hours updates automatically.</div>
            </div>
          </div>

          <!-- Availability -->
          <div class="mt-3">
            <label class="form-label required d-block">Availability (Next Semester)</label>
            <div class="d-flex flex-wrap gap-3">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="availability" value="Available" required>
                <label class="form-check-label">Available (full load)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="availability" value="Partially Available">
                <label class="form-check-label">Partially Available (reduced)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="availability" value="Unavailable">
                <label class="form-check-label">Unavailable (on leave)</label>
              </div>
            </div>
          </div>

          <!-- Max hours (auto) -->
          <div class="mt-3">
            <label class="form-label">Maximum Teaching Hours</label>
            <input id="maxHours" class="form-control" type="text" value="—" disabled>
          </div>

          <!-- Course preferences -->
          <div class="mt-4">
            <label class="form-label">Course Preferences (order matters)</label>
           

            <div class="row g-2 align-items-center">
              <div class="col-md-8">
                <select id="courseList" class="form-select">
                  <option disabled selected>Choose a course…</option>
                  <option>SWE 211 — Intro to Software Engineering</option>
                  <option>CEN 303 — Data Communications & Networks</option>
                  <option>SWE 312 — Requirements Engineering</option>
                  <option>SWE 314 — Software Security Engineering</option>
                  <option>SWE 381 — Web Applications Development</option>
                  <option>SWE 333 — Software Quality Assurance</option>
                  <option>SWE 321 — Software Design & Architecture</option>
                  <option>SWE 444 — Software Construction Lab</option>
                  <option>SWE 482 — Human-Computer Interaction</option>
                  <option>SWE 434 — Software Testing & Validation</option>
                  <option>SWE 477 — Ethics & Professional Practice</option>
                  <option>SWE 466 — Software Project Management</option>
                  <option>SWE 455 — Maintenance & Evolution</option>
                  <option>SWE 481 — Advanced Web Apps Engineering</option>
                  <option>SWE 486 — Cloud Computing & Big Data</option>
                  <option>SWE 485 — Artificial Intelligence</option>
                  <option>SWE 483 — Mobile App Design & Implementation</option>
                  <option>SWE 496 — Graduation Project 1</option>
                  <option>SWE 497 — Graduation Project 2</option>
                </select>
              </div>
              <div class="col-md-4 d-flex gap-2">
                <button id="addBtn" type="button" class="btn btn-outline-primary">Add</button>
                <button id="clearBtn" type="button" class="btn btn-outline-danger">Clear All</button>
              </div>
            </div>

            <ul id="chosen" class="list-group mt-3"></ul>
          </div>

          <!-- Actions -->
          <div class="mt-4 d-flex gap-2">
            <button class="btn btn-primary" type="submit">Submit</button>
            <a class="btn btn-outline-secondary" href="faculty-dashboard.html">Cancel</a>
          </div>

          <div class="alert alert-info mt-3 mb-0">
            Demo: يتم الحفظ في <code>localStorage</code> ثم الانتقال تلقائيًا للوحة المعلومات.
          </div>
        </form>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col-md-6"><p class="mb-0">&copy; 2025 King Saud University. All rights reserved.</p></div>
        <div class="col-md-6 text-md-end"><a href="mailto:contact@ksu.edu.sa" class="text-decoration-none">Contact Us</a></div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="script.js"></script>
  <script>checkAuth('faculty');</script>

  <!-- Page logic -->
  <script>
    // Mapping rank -> max hours (حسب المتطلبات)
    const MAX_BY_RANK = {Professor:10,"Associate Professor":12,"Assistant Professor":14,Lecturer:16,"Teaching Assistant":16};

    // حدّث خانة الساعات حسب الرتبة
    const rankSel = document.querySelector('select[name="rank"]');
    rankSel.addEventListener('change', e => {
      document.getElementById('maxHours').value = MAX_BY_RANK[e.target.value] ?? '—';
    });

    // قائمة المواد المختارة القابلة لإعادة الترتيب
    const chosen = document.getElementById('chosen');
    document.getElementById('addBtn').onclick = () => {
      const sel = document.getElementById('courseList');
      const text = sel.value && sel.selectedIndex>0 ? sel.options[sel.selectedIndex].text : null;
      if(!text) return;
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        <span class="me-3">${text}</span>
        <div class="btn-group btn-group-sm">
          <button type="button" class="btn btn-outline-secondary up">↑</button>
          <button type="button" class="btn btn-outline-secondary down">↓</button>
          <button type="button" class="btn btn-outline-danger remove">✕</button>
        </div>`;
      chosen.appendChild(li);
    };
    document.getElementById('clearBtn').onclick = () => { chosen.innerHTML=''; };
    chosen.addEventListener('click', (e)=>{
      const li = e.target.closest('li'); if(!li) return;
      if(e.target.classList.contains('up') && li.previousElementSibling) li.parentNode.insertBefore(li, li.previousElementSibling);
      if(e.target.classList.contains('down') && li.nextElementSibling) li.parentNode.insertBefore(li.nextElementSibling, li);
      if(e.target.classList.contains('remove')) li.remove();
    });

    // إرسال النموذج: حفظ في localStorage ثم التحويل للداشبورد
    document.getElementById('prefForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const data = new FormData(e.target);
      const courses = [...chosen.querySelectorAll('li span')].map(s=>s.textContent.trim());

      const payload = {
        name: data.get('name'),
        rank: data.get('rank'),
        availability: data.get('availability'),
        courses
      };
      localStorage.setItem('facultyForm', JSON.stringify(payload));
      // redirect
      location.href = 'faculty-dashboard.html';
    });

    // Prefill لطيف إذا سبق وحفِظ المستخدم
    (function prefill(){
      const saved = JSON.parse(localStorage.getItem('facultyForm') || '{}');
      if(saved.name) document.querySelector('input[name="name"]').value = saved.name;
      if(saved.rank){ rankSel.value = saved.rank; document.getElementById('maxHours').value = MAX_BY_RANK[saved.rank] ?? '—'; }
      if(saved.availability){
        const r = document.querySelector(`input[name="availability"][value="${saved.availability}"]`);
        if(r) r.checked = true;
      }
      (saved.courses||[]).forEach(c=>{
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `<span class="me-3">${c}</span>
          <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-outline-secondary up">↑</button>
            <button type="button" class="btn btn-outline-secondary down">↓</button>
            <button type="button" class="btn btn-outline-danger remove">✕</button>
          </div>`;
        chosen.appendChild(li);
      });
    })();
  </script>
</body>
</html>
